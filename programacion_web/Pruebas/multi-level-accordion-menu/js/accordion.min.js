(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?module.exports=t(require("jquery")):typeof define==="function"&&define.amd?define(["jquery"],t):(e=e||self,e.Accordion=t(e.jQuery))})(this,function($){"use strict";function extend(e,t,n){n=typeof n==="undefined"?true:toBool(n);for(var o in t){if(e.hasOwnProperty(o)&&!n)continue;e[o]=t[o]}return e}function toBool(e){return typeof e==="string"&&e.toLowerCase()==="false"?false:Boolean(e)}function parseNum(e){var t=parseFloat(e);return isNaN(t)?0:t}function parseObj(e,t){if(e&&typeof e==="object"){return e}else if(e&&typeof e==="string"){try{return JSON.parse(e)}catch(e){console.error(e.message)}}else{return t||null}}function copyObj(e){return JSON.parse(JSON.stringify(typeof e==="undefined"?null:e))}function createRequest(){if(window.XMLHttpRequest){return new XMLHttpRequest}else if(window.ActiveXObject){var e=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(var t=0;t<e.length;t++){try{return new ActiveXObject(e[t])}catch(e){}}}return null}function gradientColors(e,t,n){var o=g(e);var r=o[0];var i=o[1];var a=o[2];var s=g(t);var l=s[0];var d=s[1];var u=s[2];var p=(l-r)/n;var c=(d-i)/n;var f=(u-a)/n;var h=[];for(var m=0;m<n;m++){var v=y("rgb("+parseInt(p*m+r)+","+parseInt(c*m+i)+","+parseInt(f*m+a)+")");h.push(v)}return h;function g(e){var t=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;var e=e.toLowerCase();if(e&&t.test(e)){if(e.length===4){var n="#";for(var o=1;o<4;o+=1){n+=e.slice(o,o+1).concat(e.slice(o,o+1))}e=n}var r=[];for(var o=1;o<7;o+=2){r.push(parseInt("0x"+e.slice(o,o+2)))}return r}else{return e}}function y(e){var t=e;var n=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;if(/^(rgb|RGB)/.test(t)){var o=t.replace(/(?:(|)|rgb|RGB)*/g,"").split(",");var r="#";for(var i=0;i<o.length;i++){var a=Number(o[i]).toString(16);a=a<10?0+""+a:a;if(a==="0"){a+=a}r+=a}if(r.length!==7){r=t}return r}else if(n.test(t)){var s=t.replace(/#/,"").split("");if(s.length===6){return t}else if(s.length===3){var l="#";for(var i=0;i<s.length;i+=1){l+=s[i]+s[i]}return l}}else{return t}}}function sortTreeArr(e,t,n,o){o=o||"asc";if(!n)return e;var r=1;if(o&&o.toLowerCase()=="desc")r=-1;for(var i=0;i<e.length;i++){if(e[i][t])sortTreeArr(e[i][t],t,n,o)}sortArr(e,o,n);return e}function sortArr(e,t,r){r=r||"";var i=1;if(t&&t.toLowerCase()=="desc")i=-1;e.sort(function(e,t){var n,o;n=r?e[r]:e;o=r?t[r]:t;if(n>o){return 1*i}else if(n<o){return-1*i}else{return 0*i}});return e}function addEvent(e,t,n,o){o=toBool(o);e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n,o):e["on"+t]=n}function removeEvent(e,t,n,o){o=toBool(o);e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent("on"+t,n,o)}function preventDefaultEvent(e){e=e||window.event;e.preventDefault?e.preventDefault():e.returnValue=false;return false}function stopPropagationEvent(e){e=e||window.event;e.stopPropagation?e.stopPropagation():e.cancelBubble=true}function elData(e,t,n){var o="_elData",r=typeof t,i=typeof n;t=r==="string"?t.trim():t;if(r!=="undefined"&&i!=="undefined"){if(t===null||r==="number"||r==="boolean"){return e}if(!(o in e)){e[o]={}}e[o][t]=n;return e}if(r==="undefined"&&i==="undefined"){return e[o]||{}}if(r!=="undefined"&&i==="undefined"){return o in e&&t in e[o]?e[o][t]:undefined}}function getStyle(e,t){return window.getComputedStyle?getComputedStyle(e,null)[t]:e.currentStyle[t]}function markCss(e){if(!elData(e,"slide")){elData(e,"slide",true);elData(e,"cssText",e.style.cssText);elData(e,"borderTopWidth",getStyle(e,"border-top-width"));elData(e,"borderBottomWidth",getStyle(e,"border-bottom-width"));elData(e,"paddingTop",getStyle(e,"padding-top"));elData(e,"paddingBottom",getStyle(e,"padding-bottom"));elData(e,"height",getStyle(e,"height"))}if(elData(e,"height")==="auto"){e.setAttribute("hidden",true);var t=e.style.cssText;e.style.cssText="display:block";elData(e,"height",getStyle(e,"height"));e.style.cssText=t;e.removeAttribute("hidden")}}function nowH(e){return{bt:getStyle(e,"border-top-width"),bb:getStyle(e,"border-bottom-width"),pt:getStyle(e,"padding-top"),pb:getStyle(e,"padding-bottom"),h:getStyle(e,"height")}}function endH(e){return{css:elData(e,"cssText"),bt:elData(e,"borderTopWidth"),bb:elData(e,"borderBottomWidth"),pt:elData(e,"paddingTop"),pb:elData(e,"paddingBottom"),h:elData(e,"height")}}function slideUp(e,t){markCss(e);elData(e,"slideToggle","slideup");var n=Symbol("slide").toString(),o=nowH(e),r=endH(e),i=parseNum(o.bt),a=parseNum(o.bb),s=parseNum(o.pt),l=parseNum(o.pb),d=parseNum(o.h),u=parseNum(o.bt)+parseNum(o.bb)+parseNum(o.pt)+parseNum(o.pb)+parseNum(o.h),p=0,c=false,f=(t?u/t:u/300)*5;e.style.cssText=e.style.cssText+"overflow:hidden;";clearInterval(e[n]);e[n]=setInterval(function(){if(c){clearInterval(e[n]);e.style.cssText=r.css+"display:none";if(n in e){delete e[n]}}else{p+=f;if(a-p>0){e.style.borderBottomWidth=a-p+"px"}else{e.style.borderBottomWidth=0+"px";if(a+l-p>0){e.style.paddingBottom=a+l-p+"px"}else{e.style.paddingBottom=0+"px";if(a+l+d-p>0){e.style.height=a+l+d-p+"px"}else{e.style.height=0+"px";if(a+l+d+s-p>0){e.style.paddingTop=a+l+d+s-p+"px"}else{e.style.paddingTop=0+"px";if(a+l+d+s+i-p>0){e.style.borderTopWidth=a+l+d+s+i-p+"px"}else{e.style.borderTopWidth=0+"px";c=true}}}}}}},5)}function slideDown(e,t){markCss(e);elData(e,"slideToggle","slidedown");var n=Symbol("slide").toString(),o=nowH(e),r=endH(e),i=parseNum(r.bt),a=parseNum(r.bb),s=parseNum(r.pt),l=parseNum(r.pb),d=parseNum(r.h),u=d+s+l+i+a,p=false,c=(t?u/t:u/300)*5,f=0;if(getStyle(e,"display")==="none"){e.style.cssText=r.css+"overflow:hidden;height:0;display:block;border-top-width:0;border-bottom-width:0;padding-top:0;padding-bottom:0;"}else{e.style.cssText=e.style.cssText+"overflow:hidden";f=parseNum(o.bt)+parseNum(o.bb)+parseNum(o.pt)+parseNum(o.pb)+parseNum(o.h)}clearInterval(e[n]);e[n]=setInterval(function(){if(p){clearInterval(e[n]);e.style.cssText=r.css+"display:block";if(n in e){delete e[n]}}else{f+=c;if(i-f>0){e.style.borderTopWidth=f+"px"}else{e.style.borderTopWidth=i+"px";if(i+s-f>0){e.style.paddingTop=f-i+"px"}else{e.style.paddingTop=s+"px";if(i+s+d-f>0){e.style.height=f-i-s+"px"}else{e.style.height=d+"px";if(i+s+d+l-f>0){e.style.paddingBottom=f-i-s-d+"px"}else{e.style.paddingBottom=l+"px";if(i+s+d+l+a-f>0){e.style.borderBottomWidth=f-i-s-d-l+"px"}else{e.style.borderBottomWidth=a+"px";p=true}}}}}}},5)}function Accordion(e,t){if(!(this instanceof Accordion)){return new Accordion(e,t)}this.menu=typeof $!=="undefined"&&e instanceof jQuery&&e.length>0?e[0]:typeof e==="string"?document.querySelector(e):(typeof HTMLElement==="object"?e instanceof HTMLElement:e&&typeof e==="object"&&e.nodeType===1&&typeof e.nodeName==="string")?e:null;this.options={};this.menu.classList.add("accordion");this.init(t)}Accordion.prototype={constructor:Accordion,init:function(options){var lastOpts=elData(this.menu,"lastOpts"),menu=this.menu;this.options=lastOpts||{idField:menu.getAttribute("idField")||"id",parentField:menu.getAttribute("parentField")||"pid",nameField:menu.getAttribute("nameField")||"name",iconField:menu.getAttribute("iconField")||"",sortName:menu.getAttribute("sortName")||"",sortOrder:menu.getAttribute("sortOrder")||"asc",childrenField:menu.getAttribute("childrenField")||"children",url:menu.getAttribute("url")||"",ajaxType:menu.getAttribute("ajaxType")||"get",ajaxData:menu.getAttribute("ajaxData")||null,asTreeData:menu.getAttribute("asTreeData")?toBool(menu.getAttribute("asTreeData")):true,data:menu.getAttribute("data")||null,indentStep:menu.getAttribute("indentStep")||1,startColor:menu.getAttribute("startColor")||"#18626b",endColor:menu.getAttribute("endColor")||"#2fb9ca",colorCount:menu.getAttribute("colorCount")||5,speed:menu.getAttribute("speed")||300,onnodeclick:eval(menu.getAttribute("onnodeclick"))||null,onnodemouseenter:eval(menu.getAttribute("onnodemouseenter"))||null,onnodemouseleave:eval(menu.getAttribute("onnodemouseleave"))||null,onmenuready:eval(menu.getAttribute("onmenuready"))||null};this.options=extend(this.options,options||{},true);var opts=this.options,_this=this,colorList=gradientColors(opts.startColor,opts.endColor,opts.colorCount);setOpts();render();bindEvent();return this;function setOpts(){opts.ajaxData=parseObj(opts.ajaxData);opts.data=parseObj(opts.data);if(!opts.data){urlGetData()}opts.data=getFmtData(opts.asTreeData);if(opts.asTreeData){elData(menu,"tree",opts.data);elData(menu,"list",getFmtData(!opts.asTreeData))}else{elData(menu,"list",opts.data);elData(menu,"tree",getFmtData(!opts.asTreeData))}if(!lastOpts){for(var e in opts){menu.removeAttribute(e)}}elData(menu,"lastOpts",opts)}function urlGetData(){var e=_this.options.url,t=_this.options.ajaxType,n=_this.options.ajaxData;if(e){var o=createRequest();o.onreadystatechange=function(){if(o.readyState===4&&o.status===200){_this.options.data=typeof o.responseText==="string"?JSON.parse(o.responseText):o.responseText}};if(t&&t.toLowerCase()==="post"){o.open("post",e,false);o.setRequestHeader("Content-type","application/json;charset=utf-8");o.send(JSON.stringify(n))}else{if(n){var r="";for(var i in n){r+="&"+i+"="+n[i]}e+=e.indexOf("?")!==-1?r:r.replace("&","?")}o.open("get",e,false);o.send(null)}}else{_this.options.data=[]}}function render(){_this.menu.innerHTML="";createUl(_this.getData(true),_this.menu,null,1);menuIndent();opts.onmenuready&&eval(opts.onmenuready)&&eval(opts.onmenuready)(_this)}function createUl(e,t,r,i){var a=document.createElement("ul");e.forEach(function(e){var t=createLi(e);var n={node:copyObj(e),level:i,isLeaf:false};if(opts.childrenField in n.node)delete n.node[opts.childrenField];n.node[opts.parentField]=r;t.querySelector("a.menuitem").style.background=i<colorList.length+1?colorList[i-1]:colorList[colorList.length-1];elData(t.querySelector(":scope>.menuitem"),"sender",n);if(e[opts.childrenField]&&e[opts.childrenField].length>0){t.querySelector("a").classList.add("submenu");var o=i+1;createUl(e[opts.childrenField],t,e[opts.idField],o)}else{n.isLeaf=true}a.appendChild(t)});t.appendChild(a)}function createLi(e){var t=opts.iconField?e[opts.iconField]?e[opts.iconField]:"noicon":"";var n=document.createElement("li");var o=document.createElement("a");var r=document.createElement("i");var i=document.createTextNode(e[opts.nameField]);o.setAttribute("class","menuitem");o.setAttribute("data-id",typeof e[opts.idField]==="string"?e[opts.idField].trim():e[opts.idField]);t&&r.setAttribute("class",t);o.appendChild(r);o.appendChild(i);n.appendChild(o);return n}function menuIndent(){var e=_this.menu.querySelector(".accordion>ul"),t=0,o=parseFloat(opts.indentStep);o=isNaN(o)?1:o;r(e,t);function r(e,n){var t=e.querySelectorAll(":scope>li>ul");n=parseFloat(n)+o;t.forEach(function(e){var t=e.querySelectorAll(":scope>li>a");t.forEach(function(e){e.style.paddingLeft=n+"em"});r(e,n)})}}function bindEvent(){_this.menu.querySelectorAll("a.menuitem").forEach(function(e){removeEvent(e,"click",clickFn,false);removeEvent(e,"mouseenter",enterFn,false);removeEvent(e,"mouseleave",leaveFn,false);addEvent(e,"click",clickFn,false);addEvent(e,"mouseenter",enterFn,false);addEvent(e,"mouseleave",leaveFn,false)});function enterFn(e){this.setAttribute("title",this.innerText);opts.onnodemouseenter&&eval(opts.onnodemouseenter)(copyObj(elData(this,"sender")),_this,this,e);preventDefaultEvent(e);stopPropagationEvent(e)}function leaveFn(e){this.removeAttribute("title");opts.onnodemouseleave&&eval(opts.onnodemouseleave)(copyObj(elData(this,"sender")),_this,this,e);preventDefaultEvent(e);stopPropagationEvent(e)}function clickFn(e){var speed=_this.options.speed,_self=this;if(this.classList.contains("submenu")){if(this.classList.contains("iconopen")){this.parentNode.querySelectorAll(".iconopen,ul").forEach(function(e){e.tagName==="A"?e.classList.remove("iconopen"):getStyle(e,"display")!=="none"?slideUp(e,speed):""})}else{this.classList.add("iconopen");this.parentNode.parentNode.querySelectorAll(":scope>li>a").forEach(function(e){if(e!==_self){e.parentNode.querySelectorAll(".iconopen,ul").forEach(function(e){e.tagName==="A"?e.classList.remove("iconopen"):getStyle(e,"display")!=="none"?slideUp(e,speed):""})}else{var t=e.parentNode.querySelector("ul");t&&slideDown(t,speed)}})}}_this.menu.querySelectorAll("a.menuitem").forEach(function(e){e.classList.remove("activeitem")});this.classList.add("activeitem");opts.onnodeclick&&eval(opts.onnodeclick)(copyObj(elData(this,"sender")),_this,this,e);preventDefaultEvent(e);stopPropagationEvent(e)}}function getFmtData(e){var t=copyObj(opts.data),n=[];e=typeof e==="undefined"?toBool(opts.asTreeData):toBool(e);if(e){for(var o=0;o<t.length;o++){var r=true;for(var i=0;i<t.length;i++){if(t[o][opts.idField]===t[i][opts.parentField]){r=false}}if(r){for(var a=0;a<t.length;a++){if(t[a][opts.idField]===t[o][opts.parentField]){if(!opts.childrenField in t[a]||!Array.isArray(t[a][opts.childrenField]))t[a][opts.childrenField]=[];if(opts.parentField in t[o])delete t[o][opts.parentField];t[a][opts.childrenField].push(t[o]);t.splice(o,1);o=-1;break}}}}for(var o=0;o<t.length;o++){if(opts.parentField in t[o])delete t[o][opts.parentField]}return sortTreeArr(t,opts.childrenField,opts.sortName,opts.sortOrder)}else{s(t,n,null);return sortArr(n,opts.sortOrder,opts.sortName)}function s(e,t,n){for(var o=0;o<e.length;o++){var r=copyObj(e[o]);r[opts.parentField]=opts.parentField in e[o]?e[o][opts.parentField]:n;if(opts.childrenField in r)delete r[opts.childrenField];t.push(r);if(opts.childrenField in e[o])s(e[o][opts.childrenField],t,e[o][opts.idField])}}}},getData:function(e){e=typeof e==="undefined"?toBool(this.options.asTreeData):toBool(e);return copyObj(e?elData(this.menu,"tree"):elData(this.menu,"list"))},getNode:function(e){var t=this.menu.querySelector("[data-id='"+e+"']");return copyObj(t?elData(t,"sender").node:null)},getParentNode:function(e){return this.getNode(e[this.options.parentField])},getSelectNode:function(){return copyObj(elData(this.menu.querySelector("a.activeitem"),"sender").node)},getChildNodes:function(n,e,o){e=typeof e==="undefined"?toBool(this.options.asTreeData):toBool(e);o=toBool(o);var r=this.options,i=copyObj(this.getData(e)),a=[];if(e){l(i)}else{s(n[r.idField])}function s(e){for(var t=0;t<i.length;t++){if(i[t][r.parentField]===e){a.push(i[t]);o&&s(i[t][r.idField]);i.splice(t,1);t=0}}return a}function l(e){e.forEach(function(t){if(t[r.idField]===n[r.idField]){if(!(r.childrenField in t)||t[r.childrenField].length===0){a=[];return a}else{a=t[r.childrenField];if(!o){a.forEach(function(e){if(r.childrenField in t){delete e[r.childrenField]}})}return a}}else{if(r.childrenField in t&&t[r.childrenField].length>0){l(t[r.childrenField])}}})}return a}};if(typeof $!=="undefined"){$.fn.accordion=function(){var e=this.removeData("accordion"),t=$.extend(true,{},$.fn.accordion.data,arguments[0]);e=new Accordion(this,t);this.data("accordion",e);return $.extend(true,this,e)};$.fn.accordion.constructor=Accordion}return Accordion});
